<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:p="http://www.springframework.org/schema/p"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
                    http://www.springframework.org/schema/beans/spring-beans-3.0.xsd">
    <!--
     Copyright 2007-2009 The Kuali Foundation

     Licensed under the Educational Community License, Version 2.0 (the "License");
     you may not use this file except in compliance with the License.
     You may obtain a copy of the License at

     http://www.opensource.org/licenses/ecl2.php

     Unless required by applicable law or agreed to in writing, software
     distributed under the License is distributed on an "AS IS" BASIS,
     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     See the License for the specific language governing permissions and
     limitations under the License.
    -->

    <!-- Lookup View -->
    <bean id="PlanAuditsSummary-LookupView" parent="MyPlanBaseLookupView">
        <property name="onLoadScript" value=""/>
        <property name="headerText" value="Recent Audit Reports"/>
        <property name="page.header.render" value="false"/>
        <property name="header.render" value="false"/>
        <property name="footer.render" value="false"/>
        <property name="dataObjectClassName" value="org.kuali.student.myplan.audit.dataobject.PlanAuditItem"/>
        <property name="viewHelperServiceClass"
                  value="org.kuali.student.myplan.audit.service.PlanAuditsLookupableHelperImpl"/>
        <property name="singlePageView" value="true"/>
        <property name="criteriaFields">
            <list/>
        </property>
        <property name="resultFields">
            <list/>
        </property>

        <!-- Not Displaying any criteria -->
        <property name="criteriaGroup">
            <bean parent="KSAP-VerticalBoxGroup">
                <property name="footer">
                    <bean parent="KSAP-EmptyLookupCriteriaFooter"/>
                </property>
            </bean>

        </property>
        <property name="resultsGroup">
            <bean id="plan_audits_summary" parent="plan_audits_summary_list"/>
        </property>
    </bean>

    <bean id="plan_audits_summary_list" parent="KSAP-StackedCollectionGroup" p:headerText="Recent Plan Audits">
        <property name="collectionObjectClass" value="org.kuali.student.myplan.audit.dataobject.PlanAuditItem"/>
        <property name="propertyName" value="lookupResults"/>
        <property name="header">
            <bean parent="KSAP-ModuleHeader"/>
        </property>
        <property name="header.rightGroup">
            <bean parent="KSAP-HorizontalBoxGroup">
                <property name="items">
                    <list>
                        <ref bean="recent_plan_audits_help_icon"/>
                    </list>
                </property>
            </bean>
        </property>
        <property name="header.rightGroup.cssClasses" value="module__headerRightGroup"/>
        <property name="cssClasses" value="module"/>
        <property name="layoutManager.lineGroupPrototype.cssClasses" value="module__item"/>
        <property name="onDocumentReadyScript" value="
            var pendingAudit = jQuery.cookie('pendingAudit');
            if (pendingAudit) getPendingAudit('plan_audits_summary', 'plan', pendingAudit);
            if (readUrlParam('viewId') == 'PlanAudit-FormView') {
                indicateViewingAudit('plan_audits_summary', 'plan');
            }
            jQuery('#plan_audits_summary').on('AUDIT_COMPLETE AUDIT_ERROR', function(event, data) {
                removeCookie('pendingAudit');
            });
            jQuery('#plan_audits_summary').on('REFRESH_AUDITS AUDIT_ERROR', function(event, data) {
                if( data.auditType == 'plan' ) {
                    customRetrieveComponent('plan_audits_summary','plan_audits_summary','search','lookup',{viewId:'PlanAuditsSummary-LookupView'});
                }
            });
            jQuery('#plan_audits_summary').on('AUDIT_COMPLETE', function(event, data) {
                if( data.auditType == 'plan' ) {
                    var newAudit = jQuery('.auditReport__html--' + data.auditType + ' .myplan-audit-report').attr('auditid');
                    customRetrieveComponent('plan_audits_summary','plan_audits_summary','search','lookup',{viewId:'PlanAuditsSummary-LookupView'}, 'link_' + newAudit);
                }
            });
        "/>
        <property name="filters">
            <list>
                <bean parent="Uif-ConditionalCollectionFilter" p:expression="#index lt 7"/>
            </list>
        </property>
        <property name="layoutManager">
            <bean parent="Uif-StackedCollectionLayout-WithBoxItems">
                <property name="lineGroupPrototype">
                    <bean parent="Uif-CollectionVerticalBoxItem">
                        <property name="id" value="link_@{#line.report.auditId}"/>
                        <property name="title" value="@{#line.programTitle}"/>
                        <property name="hidden" value="@{#index gt 1}"/>
                        <property name="onClickScript" value="
                            openDocument('audit?methodToCall=audit&amp;viewId=PlanAudit-FormView&amp;planAudit.auditId=@{#line.report.auditId}');
                        "/>
                        <property name="cssClasses">
                            <list merge="true">
                                <value>@{#index gt 1 ? 'collapsible':''}</value>
                            </list>
                        </property>
                        <property name="footer.render" value="false"/>
                        <property name="validationMessages">
                            <null/>
                        </property>
                    </bean>
                </property>
            </bean>
        </property>
        <property name="instructionalMessage">
            <bean parent="KSAP-Message" p:messageText="No recent Plan Audits found.">
                <property name="cssClasses" value="module__empty"/>
            </bean>
        </property>
        <property name="instructionalMessage.render" value="@{lookupResults EQ null OR lookupResults.size() EQ 0}"/>
        <property name="items">
            <list>
                <bean parent="KSAP-HorizontalFieldGroup">
                    <property name="onDocumentReadyScript"
                              value="if (@{#line.recentAudit}) jQuery('button#plan_audit_validate').data('recentauditid', '@{#line.report.auditId}');"/>
                    <property name="group.instructionalMessage">
                        <bean parent="Uif-Message">
                            <property name="messageText" value="You are viewing"/>
                            <property name="cssClasses" value="module__view module--gray"/>
                        </bean>
                    </property>
                    <property name="items">
                        <list>
                            <bean parent="KSAP-SimpleDataField" p:propertyName="report.runDate" p:width="40px">
                                <property name="escapeHtmlInPropertyValue" value="false"/>
                                <property name="propertyEditor" ref="plan_audit_timestamp_formatter"/>
                                <property name="cssClasses">
                                    <list merge="true">
                                        <value>module__timestampBadge</value>
                                    </list>
                                </property>
                            </bean>
                            <bean parent="KSAP-HorizontalBoxGroup" p:width="158px">
                                <property name="instructionalMessage">
                                    <bean parent="Uif-Message">
                                        <property name="messageText" value="Plan Includes"/>
                                        <property name="cssClasses" value="module--min module--uppercase"/>
                                    </bean>
                                </property>
                                <property name="items">
                                    <list>
                                        <bean parent="planAuditData" p:label="Courses"
                                              p:propertyName="auditedCoursesCount"/>
                                        <bean parent="planAuditData" p:label="Credits"
                                              p:propertyName="totalAuditedCredit"/>
                                        <bean parent="planAuditData" p:label="Through"
                                              p:propertyName="auditedQuarterUpTo"/>
                                    </list>
                                </property>
                                <property name="footer">
                                    <bean parent="KSAP-VerticalBoxGroup">
                                        <property name="items">
                                            <list>
                                                <bean parent="KSAP-SimpleDataField" p:propertyName="programTitle"
                                                      p:width="100%">
                                                    <property name="escapeHtmlInPropertyValue" value="false"/>
                                                    <property name="cssClasses" value="module--bold"/>
                                                </bean>
                                            </list>
                                        </property>
                                    </bean>
                                </property>
                            </bean>
                        </list>
                    </property>
                </bean>

                <bean parent="KSAP-SimpleDataField" p:propertyName="requestedBy" p:label="RUN BY"
                      p:render="@{#line.runByAdviser}">
                    <property name="labelPlacement" value="LEFT"/>
                    <property name="fieldLabel.render" value="true"/>
                    <property name="fieldLabel.cssClasses" value="module__planAuditLabel"/>
                </bean>

            </list>
        </property>
        <property name="footer">
            <bean parent="KSAP-VerticalBoxGroup">
                <property name="cssClasses" value="module__footer"/>
                <property name="layoutManager.cssClasses" value="module__footer--right"/>
                <property name="items">
                    <list>
                        <bean id="plan_audit_toggle_link" parent="Uif-ActionLink"
                              p:actionLabel="Show @{lookupResults.size() GT 7 ? '5' : (lookupResults.size() - 2)} additional Plan Audit(s)">
                            <property name="actionScript"
                                      value="toggleComponentContent(this, 'plan_audits_summary', '.collapsible', 'Show @{lookupResults.size() GT 7 ? '5' : (lookupResults.size() - 2)} additional Plan Audit(s)', 'Hide @{lookupResults.size() GT 7 ? '5' : (lookupResults.size() - 2)} additional Plan Audit(s)');"/>
                        </bean>
                    </list>
                </property>
            </bean>
        </property>
        <property name="footer.render" value="@{lookupResults NE null AND lookupResults.size() GT 2}"/>
    </bean>

    <bean id="planAuditData" parent="KSAP-SimpleDataField" p:width="33%">
        <property name="labelPlacement" value="RIGHT"/>
        <property name="fieldLabel.render" value="true"/>
        <property name="fieldLabel.cssClasses" value="module__planAuditLabel"/>
        <property name="cssClasses" value="module__planAuditData"/>
    </bean>

    <bean id="PlanAudit-FormView" parent="MyPlanFormView">
        <property name="headerText" value="Audit"/>
        <property name="formClass" value="org.kuali.student.myplan.audit.form.AuditForm"/>
        <!-- To Support progressive disclosure of campus select -->
        <property name="persistFormToSession" value="true"/>
        <property name="viewName" value="PlanAudit-FormView"/>
        <property name="id" value="PlanAudit-FormView"/>
        <property name="entryPageId" value="plan_audit"/>
        <property name="additionalScriptFiles">
            <list>
                <!-- TODO: remove fancybox linkage after https://jira.kuali.org/browse/KULRICE-9396 is resolved -->
                <value>ks-myplan/plugins/jquery.fancybox.pack.js?2.1.4</value>
            </list>
        </property>
        <property name="items">
            <list>
                <bean parent="KSAP-Page" p:id="plan_audit">
                    <property name="items">
                        <list>
                            <bean parent="plan_audit_block" p:width="710px"/>
                            <bean parent="KSAP-RightPane" p:width="230px">
                                <property name="items">
                                    <list>
                                        <bean parent="KSAP-YourStuff">
                                            <property name="items">
                                                <list>
                                                    <bean parent="KSAP-PlanAuditList"/>
                                                    <bean parent="KSAP-DegreeAuditList"/>
                                                    <bean parent="KSAP-BookmarkList"/>
                                                </list>
                                            </property>
                                        </bean>
                                    </list>
                                </property>
                            </bean>
                        </list>
                    </property>
                </bean>

                <bean parent="KSAP-Page" p:id="plan_audit_non_student_page">
                    <property name="items">
                        <list>
                            <bean parent="KSAP-VerticalBoxGroup" p:width="710px">
                                <property name="items">
                                    <list>
                                        <bean parent="KSAP-HorizontalBoxGroup">
                                            <property name="items">
                                                <list>
                                                    <bean parent="KSAP-VerticalFieldGroup">
                                                        <property name="cssClasses">
                                                            <list merge="true">
                                                                <value>fl-container-600</value>
                                                                <value>myplan-audit-info-panel</value>
                                                                <value>myplan-audit-message-info</value>
                                                            </list>
                                                        </property>
                                                        <property name="items">
                                                            <list>
                                                                <bean parent="KSAP-Message">
                                                                    <property name="messageText"
                                                                              value="The Audit feature is disabled for non-students. We are unable to run a degree audit for you at this time."/>
                                                                </bean>
                                                            </list>
                                                        </property>
                                                    </bean>
                                                </list>
                                            </property>
                                        </bean>
                                    </list>
                                </property>
                            </bean>
                            <bean parent="KSAP-RightPane" p:width="230px"/>
                        </list>
                    </property>
                </bean>
            </list>
        </property>
        <property name="footer.render" value="false"/>
    </bean>

    <bean id="plan_audit_block" parent="KSAP-VerticalBoxGroup">
        <property name="items">
            <list>
                <bean parent="audit_tabs">
                    <property name="items">
                        <list>
                            <bean parent="audit_tab_plan" p:cssClasses="auditTabs--active"/>
                            <bean parent="audit_tab_degree"/>
                        </list>
                    </property>
                </bean>
                <bean parent="run_plan_audits"/>
                <ref bean="plan_audit_section"/>
            </list>
        </property>
    </bean>

    <bean id="run_plan_audits" parent="KSAP-VerticalBoxGroup">
        <property name="cssClasses" value="auditRun"/>
        <property name="items">
            <list>
                <bean parent="plan_items_empty_message"/>
                <!--TODO: https://jira.kuali.org/browse/KULRICE-9846 progressiveRender expressions are evaluated before the defaultValue is set, workaround is to set the value on the backend -->
                <bean parent="KSAP-SimpleInputField" p:propertyName="planAudit.campusParam" p:defaultValue="306">
                    <property name="instructionalMessage">
                        <bean parent="KSAP-Message" p:messageText="Select your campus and intended degree program from the dropdown menu below."/>
                    </property>
                    <property name="control">
                        <bean parent="Uif-HorizontalRadioControl" p:fieldsetClasses="auditRun__radioSet"/>
                    </property>
                    <property name="optionsFinder">
                        <bean class="org.kuali.student.myplan.course.util.AuditRunCampusParam"/>
                    </property>
                </bean>
                <bean parent="KSAP-SimpleInputField" p:propertyName="planExists" p:hidden="true"
                      p:defaultValue="@{#form.planExists}">
                    <property name="control">
                        <bean parent="Uif-HiddenControl"/>
                    </property>
                </bean>
                <bean parent="KSAP-HorizontalBoxGroup">
                    <property name="items">
                        <list>
                            <bean parent="KSAP-SimpleInputField"
                                  p:progressiveRender="planAudit.campusParam eq '306'"
                                  p:propertyName="planAudit.programParamSeattle" p:width="auto">
                                <property name="control">
                                    <bean parent="Uif-DropdownControl"/>
                                </property>
                                <property name="optionsFinder">
                                    <bean class="org.kuali.student.myplan.course.util.DegreeAuditSeattlePrograms"/>
                                </property>
                            </bean>
                            <bean parent="KSAP-SimpleInputField"
                                  p:progressiveRender="planAudit.campusParam eq '310'"
                                  p:propertyName="planAudit.programParamBothell" p:width="auto">
                                <property name="control">
                                    <bean parent="Uif-DropdownControl"/>
                                </property>
                                <property name="optionsFinder">
                                    <bean class="org.kuali.student.myplan.course.util.DegreeAuditBothellPrograms"/>
                                </property>
                            </bean>
                            <bean parent="KSAP-SimpleInputField"
                                  p:progressiveRender="planAudit.campusParam eq '323'"
                                  p:propertyName="planAudit.programParamTacoma" p:width="auto">
                                <property name="control">
                                    <bean parent="Uif-DropdownControl"/>
                                </property>
                                <property name="optionsFinder">
                                    <bean class="org.kuali.student.myplan.course.util.DegreeAuditTacomaPrograms"/>
                                </property>
                            </bean>
                            <bean id="plan_audit_actions_container" parent="KSAP-HorizontalBoxGroup" p:width="200px">
                                <property name="items">
                                    <list>
                                        <ref bean="plan_audit_validate"/>
                                        <ref bean="plan_audit_run"/>
                                    </list>
                                </property>
                            </bean>
                        </list>
                    </property>
                </bean>
                <bean parent="KSAP-Message" p:messageText="[0] in the degree program list for audit.">
                    <property name="inlineComponents">
                        <list>
                            <bean parent="Uif-Link" p:linkText="Some programs are not included"
                                  p:style="text-decoration:underline;" p:target="_blank"
                                  p:href="http://depts.washington.edu/myplan/help-site/#855"/>
                        </list>
                    </property>
                </bean>
                <bean parent="KSAP-SimpleInputField" p:propertyName="planAudit.lastPlannedTerm" p:hidden="true">
                    <property name="control">
                        <bean parent="Uif-HiddenControl"/>
                    </property>
                </bean>
                <ref bean="plan_hand_off_container"/>
            </list>
        </property>
    </bean>

    <bean id="plan_audit_validate" parent="KSAP-PrimaryActionButton" p:actionLabel="Audit Your Plan"
          p:title="Audit Your Plan">
        <property name="disabled"
                  value="@{(#form.planExists EQ false) OR (#form.planAudit.campusParam EQ '306' AND #form.planAudit.programParamSeattle EQ 'default') OR (#form.planAudit.campusParam EQ '310' AND #form.planAudit.programParamBothell EQ 'default') OR (#form.planAudit.campusParam EQ '323' AND #form.planAudit.programParamTacoma EQ 'default')}"/>
        <property name="actionScript" value="validatePlanAudit(jQuery(this));"/>
        <property name="onDocumentReadyScript" value="
            var disableCompId = 'plan_audit_validate';
            var condition = function () {
                return ((jQuery.cookie('pendingAudit') != null) || (coerceValue('planExists') == false) || (coerceValue('planAudit.campusParam') == '306' &amp;&amp; coerceValue('planAudit.programParamSeattle') == 'default') || (coerceValue('planAudit.campusParam') == '310' &amp;&amp; coerceValue('planAudit.programParamBothell') == 'default') || (coerceValue('planAudit.campusParam') == '323' &amp;&amp; coerceValue('planAudit.programParamTacoma') == 'default'));
            };
            disabledCheck(disableCompId, 'action', condition);
            jQuery('button#' + disableCompId).on('AUDIT_COMPLETE', function (event, data) {
                var condition = function () {
                    return ((coerceValue('planExists') == false) || (coerceValue('planAudit.campusParam') == '306' &amp;&amp; coerceValue('planAudit.programParamSeattle') == 'default') || (coerceValue('planAudit.campusParam') == '310' &amp;&amp; coerceValue('planAudit.programParamBothell') == 'default') || (coerceValue('planAudit.campusParam') == '323' &amp;&amp; coerceValue('planAudit.programParamTacoma') == 'default'));
                };
                disabledCheck(jQuery(this).attr('id'), 'action', condition);
            });
        "/>
        <property name="dataAttributes">
            <map>
                <entry key="audittype" value="plan"/>
            </map>
        </property>
    </bean>

    <bean id="plan_audit_run" parent="KSAP-PrimaryActionButton" p:methodToCall="runPlanAudit" p:hidden="true"
          p:disabled="false" p:refreshId="plan_audit_section" p:focusOnIdAfterSubmit="plan_audits_summary" p:disableBlocking="true"
          p:actionLabel="Audit Plan">
        <!-- Leave actionInvokeHandler in actionscript or the methodToCall will not execute on audit run -->
        <property name="actionScript" value="actionInvokeHandler(this); setPendingAudit(jQuery('button#plan_audit_validate'), 5);"/>
        <property name="dataAttributes">
            <map>
                <entry key="audittype" value="plan"/>
            </map>
        </property>
    </bean>

    <bean id="plan_items_empty_message" parent="KSAP-InfoMessage" p:render="@{!#form.planExists}">
        <property name="items">
            <list>
                <bean parent="KSAP-Message"
                      p:messageText="You have no planned courses available to audit. [0] and add them to your plan.">
                    <property name="inlineComponents">
                        <list>
                            <bean parent="Uif-Link" p:linkText="Find courses"
                                  p:href="course?methodToCall=start&amp;viewId=CourseSearch-FormView"/>
                        </list>
                    </property>
                </bean>
            </list>
        </property>
    </bean>

    <bean id="plan_audit_section" parent="Uif-VerticalBoxGroup">
        <property name="onDocumentReadyScript" value="
            if (jQuery.cookie('pendingAudit')) {
                if (readUrlParam('planAudit.auditId') == false) {
                    var data = jQuery.parseJSON(decodeURIComponent(jQuery.cookie('pendingAudit')));
                    blockPendingAudit(data, true);
                }
            }
        "/>
        <property name="cssClasses" value="auditReport"/>
        <property name="items">
            <list>
                <bean parent="empty_plan_audits"/>
                <bean parent="plan_audit_report_section"/>
            </list>
        </property>
    </bean>

    <bean id="empty_plan_audits" parent="KSAP-HorizontalBoxGroup"
          p:headerText="How to Use Plan Audit for Academic Planning">
        <property name="render" value="@{#form.planAudit.auditHtml EQ null}"/>
        <property name="header">
            <bean parent="KSAP-HeaderFour"/>
        </property>
        <property name="items">
            <list>
                <bean parent="KSAP-VerticalBoxGroup" p:headerText="Will your plan meet your program requirements?">
                    <property name="header">
                        <bean parent="KSAP-HeaderFive" p:cssClasses="auditRun__infoHeader" p:headerTagCssClasses="auditRun__infoHeaderText"/>
                    </property>
                    <property name="cssClasses" value="auditRun__info"/>
                    <property name="items">
                        <list>
                            <bean parent="KSAP-Message">
                                <property name="messageText"
                                          value="Plan Audit compares planned courses and your academic record with your requirements to give you an idea of what will be needed to complete your degree.[br/][br/]This Audit is meant as a planning tool and is not an official evaluation of academic progress. Work with your adviser to ensure that your planned courses will meet your degree or program requirements."/>
                            </bean>
                        </list>
                    </property>
                </bean>
                <bean parent="KSAP-VerticalBoxGroup" p:headerText="What do you need to do?">
                    <property name="header">
                        <bean parent="KSAP-HeaderFive" p:cssClasses="auditRun__infoHeader" p:headerTagCssClasses="auditRun__infoHeaderText"/>
                    </property>
                    <property name="cssClasses" value="auditRun__info"/>
                    <property name="items">
                        <list>
                            <bean parent="KSAP-Message">
                                <property name="messageText"
                                          value="Make sure that you have added courses to your plan for future quarters, then select your program from the menu above and run a Plan Audit to see if you are on the right track.â€¨"/>
                            </bean>
                        </list>
                    </property>
                </bean>
            </list>
        </property>
    </bean>

    <bean id="plan_audit_report_section" parent="KSAP-VerticalBoxGroup" p:headerText="Plan Audit">
        <property name="onDocumentReadyScript" value="initAuditActions();"/>
        <property name="header">
            <bean parent="KSAP-HeaderSix"/>
        </property>
        <property name="header.render" value="@{#form.planAudit.auditHtml NE null}"/>
        <property name="cssClasses" value="auditReport__html--plan"/>
        <property name="items">
            <list>
                <bean parent="KSAP-NoSpanMessage" p:id="@{planAudit.auditId NE null ? planAudit.auditId : 'empty_audit_html'}" p:messageText="@{planAudit.auditHtml}"/>
            </list>
        </property>
    </bean>

    <bean id="plan_hand_off_container" parent="KSAP-VerticalBoxGroup" p:hidden="true">
        <property name="items" value=""/>
    </bean>


    <!-- Not used to view audit reports. -->
    <bean id="PlanAuditHandOff-FormView" parent="MyPlanBaseFormView">
        <property name="formClass" value="org.kuali.student.myplan.audit.form.AuditForm"/>
        <property name="onLoadScript" value=""/>
        <!-- To Support progressive disclosure of campus select -->
        <property name="persistFormToSession" value="true"/>
        <property name="viewName" value="PlanAuditHandOff-FormView"/>
        <property name="id" value="PlanAuditHandOff-FormView"/>
        <property name="entryPageId" value="plan_audit_hand_off"/>
        <property name="items">
            <list>
                <bean parent="Uif-Page" p:id="plan_audit_hand_off" p:width="650px">
                    <property name="layoutManager">
                        <bean parent="Uif-VerticalBoxLayout"/>
                    </property>
                    <property name="cssClasses" value="auditHandOff"/>
                    <property name="header">
                        <bean parent="KSAP-HeaderTwo" p:headerText="Enter details about your plan">
                            <property name="cssClasses" value="getHeight"/>
                            <property name="propertyReplacers">
                                <list>
                                    <bean parent="Uif-ConditionalBeanPropertyReplacer" p:propertyName="headerText"
                                          p:condition="#form.planAudit.messyItems.size() EQ 0"
                                          p:replacement="@{#form.planAudit.cleanList.size() EQ 0 ? 'No Plan Audit Available' : ' '}"/>
                                    <bean parent="Uif-ConditionalBeanPropertyReplacer" p:propertyName="headerText"
                                          p:condition="T(org.kuali.student.myplan.plan.util.AtpHelper).getUserSessionHelper().isAdviser() AND #form.planAudit.messyItems.size() GT 0"
                                          p:replacement="View details about @{T(org.kuali.student.myplan.plan.util.AtpHelper).getUserSessionHelper().getFirstName( T(org.kuali.student.myplan.plan.util.AtpHelper).getUserSessionHelper().getStudentId()  )}'s plan"/>
                                </list>
                            </property>
                        </bean>
                    </property>
                    <property name="instructionalMessage">
                        <bean parent="KSAP-Message">
                            <property name="messageText"
                                      value="To run your Plan Audit, MyPlan needs more information for the following course(s)"/>
                            <property name="cssClasses" value="getHeight"/>
                            <property name="propertyReplacers">
                                <list>
                                    <bean parent="Uif-ConditionalBeanPropertyReplacer" p:propertyName="messageText"
                                          p:condition="#form.planAudit.messyItems.size() EQ 0"
                                          p:replacement="@{#form.planAudit.cleanList.size() GT 0 ? ' ' : 'We are unable to generate a Plan Audit. [0]'}"/>
                                    <bean parent="Uif-ConditionalBeanPropertyReplacer" p:propertyName="messageText"
                                          p:condition="T(org.kuali.student.myplan.plan.util.AtpHelper).getUserSessionHelper().isAdviser() AND #form.planAudit.messyItems.size() GT 0"
                                          p:replacement="@{T(org.kuali.student.myplan.plan.util.AtpHelper).getUserSessionHelper().getFirstName(T(org.kuali.student.myplan.plan.util.AtpHelper).getUserSessionHelper().getStudentId())} chose the following course options for their Plan Audit:"/>
                                </list>
                            </property>
                            <property name="inlineComponents">
                                <list>
                                    <bean parent="Uif-Link" p:linkText="Learn more." p:target="_blank"
                                          p:href="http://depts.washington.edu/myplan/help-site/"/>
                                </list>
                            </property>
                        </bean>
                    </property>
                    <property name="items">
                        <list>
                            <!-- Adviser with null credit selection -->
                            <bean parent="KSAP-WarningMessage"
                                  p:render="@{T(org.kuali.student.myplan.plan.util.AtpHelper).getUserSessionHelper().isAdviser() AND
                                              !#form.planAudit.allMessyItemsSelected}">
                                <property name="cssClasses">
                                    <list merge="true">
                                        <value>getHeight</value>
                                    </list>
                                </property>
                                <property name="items">
                                    <list>
                                        <bean parent="KSAP-Message">
                                            <property name="messageText"
                                                      value="We are unable to generate a Plan Audit because more information is needed from @{T(org.kuali.student.myplan.plan.util.AtpHelper).getUserSessionHelper().getStudentName( )}. [0]"/>
                                            <property name="inlineComponents">
                                                <list>
                                                    <bean parent="Uif-Link" p:linkText="Learn more." p:target="_blank"
                                                          p:href="http://depts.washington.edu/myplan/help-site/"/>
                                                </list>
                                            </property>
                                        </bean>
                                    </list>
                                </property>
                            </bean>

                            <bean p:id="showHandOffScreen" parent="KSAP-SimpleInputField" p:hidden="true"
                                  p:propertyName="planAudit.showHandOffScreen">
                                <property name="control">
                                    <bean parent="Uif-HiddenControl"/>
                                </property>
                            </bean>
                            <bean parent="KSAP-VerticalBoxGroup">
                                <property name="cssClasses">
                                    <list merge="true">
                                        <value>auditHandOff__scrollGroup</value>
                                        <value>@{#form.planAudit.messyItems.size() EQ 0 ? 'auditHandOff__scrollGroup--noBorder' : ''}</value>
                                    </list>
                                </property>
                                <property name="items">
                                    <list>
                                        <bean parent="plan_audit_clean_items"/>
                                        <bean parent="plan_audit_messy_items"
                                              p:render="@{#form.planAudit.messyItems.size() GT 0}"/>
                                        <bean parent="plan_audit_ignore_items"
                                              p:render="@{#form.planAudit.ignoreList.size() GT 0}"/>
                                    </list>
                                </property>
                            </bean>

                            <!-- Plan Submit button for student's and for advisers (when all student choices are specified) -->
                            <bean parent="KSAP-HorizontalBoxGroup">
                                <property name="cssClasses" value="auditHandOff__buttonGroup getHeight"/>
                                <property name="render"
                                          value="@{#form.planAudit.cleanList.size() + #form.planAudit.messyItems.size() GT 0}"/>
                                <property name="items">
                                    <list>
                                        <bean id="submit_plan_audit" parent="KSAP-PrimaryActionButton" p:disabled="true"
                                              p:render="@{!T(org.kuali.student.myplan.plan.util.AtpHelper).getUserSessionHelper().isAdviser() OR
                                              #form.planAudit.allMessyItemsSelected}">
                                            <property name="actionLabel"
                                                      value="@{#form.planAudit.messyItems.size() EQ 0 ? 'Continue' : 'Submit'}"/>
                                            <property name="actionScript" value="runPlanAudit('plan_audit_run');"/>
                                            <property name="onDocumentReadyScript"
                                                      value="buttonState('plan_audit_messy_items', 'submit_plan_audit');"/>
                                        </bean>
                                        <bean parent="Uif-ActionLink" p:actionLabel="Cancel"
                                              p:render="@{!T(org.kuali.student.myplan.plan.util.AtpHelper).getUserSessionHelper().isAdviser() OR
                                              #form.planAudit.allMessyItemsSelected}">
                                            <property name="actionScript" value="jQuery.fancybox.close(true);"/>
                                            <property name="cssClasses" value="auditHandOff__actionLink"/>
                                        </bean>
                                        <bean parent="KSAP-PrimaryActionButton" p:actionLabel="Ok"
                                              p:render="@{T(org.kuali.student.myplan.plan.util.AtpHelper).getUserSessionHelper().isAdviser() AND
                                              !#form.planAudit.allMessyItemsSelected}">
                                            <property name="actionScript" value="jQuery.fancybox.close(true);"/>
                                        </bean>
                                    </list>
                                </property>
                            </bean>

                            <bean parent="KSAP-HorizontalBoxGroup">
                                <property name="cssClasses" value="getHeight"/>
                                <property name="render"
                                          value="@{#form.planAudit.cleanList.size() + #form.planAudit.messyItems.size() EQ 0}"/>
                                <property name="items">
                                    <list>
                                        <bean parent="KSAP-PrimaryActionButton" p:actionLabel="Ok">
                                            <property name="actionScript" value="jQuery.fancybox.close(true);"/>
                                        </bean>
                                    </list>
                                </property>
                            </bean>
                        </list>
                    </property>
                </bean>
            </list>
        </property>
        <property name="footer.render" value="false"/>
    </bean>

    <bean id="plan_audit_clean_items" parent="KSAP-StackedCollectionGroup" p:hidden="true">
        <property name="collectionObjectClass"
                  value="org.kuali.student.myplan.audit.dataobject.CourseItem"/>
        <property name="propertyName" value="planAudit.cleanList"/>
        <property name="bindingInfo.bindToForm" value="true"/>
        <property name="readOnly" value="false"/>
        <property name="cssClasses" value="removeMargin"/>
        <property name="items">
            <list>
                <bean p:id="hidden_courseItem_course_id" parent="KSAP-SimpleInputField" p:propertyName="courseId">
                    <property name="control">
                        <bean parent="Uif-HiddenControl"/>
                    </property>
                </bean>
                <bean p:id="hidden_courseItem_course_code" parent="KSAP-SimpleInputField" p:propertyName="courseCode">
                    <property name="control">
                        <bean parent="Uif-HiddenControl"/>
                    </property>
                </bean>
                <bean p:id="hidden_courseItem_course_subject" parent="KSAP-SimpleInputField" p:propertyName="subject"
                      p:hidden="true">
                    <property name="control">
                        <bean parent="Uif-HiddenControl"/>
                    </property>
                </bean>
                <bean p:id="hidden_courseItem_course_number" parent="KSAP-SimpleInputField" p:propertyName="number"
                      p:hidden="true">
                    <property name="control">
                        <bean parent="Uif-HiddenControl"/>
                    </property>
                </bean>
                <bean p:id="hidden_courseItem_section_code" parent="KSAP-SimpleInputField" p:propertyName="sectionCode">
                    <property name="control">
                        <bean parent="Uif-HiddenControl"/>
                    </property>
                </bean>
                <bean p:id="hidden_courseItem_section_code" parent="KSAP-SimpleInputField"
                      p:propertyName="secondaryActivityCode">
                    <property name="control">
                        <bean parent="Uif-HiddenControl"/>
                    </property>
                </bean>
                <bean p:id="hidden_courseItem_atp_id" parent="KSAP-SimpleInputField" p:propertyName="atpId">
                    <property name="control">
                        <bean parent="Uif-HiddenControl"/>
                    </property>
                </bean>
                <bean p:id="hidden_courseItem_credit" parent="KSAP-SimpleInputField" p:propertyName="credit">
                    <property name="control">
                        <bean parent="Uif-HiddenControl"/>
                    </property>
                </bean>
            </list>
        </property>
    </bean>

    <bean id="plan_audit_messy_items" parent="KSAP-StackedCollectionGroup" p:id="plan_audit_messy_items">
        <property name="collectionObjectClass"
                  value="org.kuali.student.myplan.audit.dataobject.MessyTermDataObject"/>
        <property name="propertyName" value="planAudit.messyItems"/>
        <property name="bindingInfo.bindToForm" value="true"/>
        <property name="readOnly" value="false"/>
        <property name="cssClasses" value="auditHandOff__messy"/>
        <property name="items">
            <list/>
        </property>
        <property name="subCollections">
            <list>
                <ref bean="plan_audit_messy_block"/>
            </list>
        </property>
    </bean>

    <bean id="plan_audit_messy_block" parent="KSAP-StackedCollectionGroup">
        <property name="collectionObjectClass" value="org.kuali.student.myplan.audit.dataobject.MessyItem"/>
        <property name="propertyName" value="messyItemList"/>
        <property name="bindingInfo.bindToForm" value="true"/>
        <property name="readOnly" value="false"/>
        <property name="header">
            <bean parent="KSAP-HeaderFour" p:headerText="@{T(org.kuali.student.myplan.plan.util.AtpHelper).atpIdToTermName(#line.atpId)}"/>
        </property>
        <property name="items">
            <list>
                <bean parent="KSAP-VerticalFieldGroup">
                    <property name="cssClasses" value="@{T(org.kuali.student.myplan.plan.util.AtpHelper).getUserSessionHelper().isAdviser() AND #line.selectedCredit EQ null? 'alert' : ''}">
                    </property>
                    <property name="items">
                        <list>
                            <bean parent="Uif-LinkField">
                                <property name="linkText" value="@{#line.courseCode} @{#line.courseTitle}"/>
                                <property name="title" value="@{#line.courseCode} @{#line.courseTitle}"/>
                                <property name="href"
                                          value="inquiry?methodToCall=start&amp;viewId=CourseDetails-InquiryView&amp;courseId=@{#line.courseId}&amp;courseCd=@{#line.courseCode NE null ? #line.courseCode.replace('&amp;','%26') : #line.courseCode}"/>
                            </bean>

                            <!-- Adviser with null credit selection -->
                            <bean parent="KSAP-MessageField">
                                <property name="render" value="@{T(org.kuali.student.myplan.plan.util.AtpHelper).getUserSessionHelper().isAdviser() AND #line.selectedCredit EQ null}"/>
                                <property name="messageText"
                                          value="@{T(org.kuali.student.myplan.plan.util.AtpHelper).getUserSessionHelper().getStudentName()} must provide more details about this course."/>
                            </bean>
                        </list>
                    </property>
                </bean>

                <bean id="messy_quarter" parent="KSAP-MessageField" p:hidden="true">
                    <property name="messageText"
                              value="@{T(org.kuali.student.myplan.plan.util.AtpHelper).atpIdToTermName(#line.atpAndAddMessyItemToReq)}"/>
                </bean>

                <!--This hidden selected credit is used in adviser view to pass selected credit value to the form,
                 as the dropDown  control is disabled the value will not be passed to form-->
                <bean p:id="hidden_selected_credit" parent="KSAP-SimpleInputField"
                      p:propertyName="selectedCredit" p:hidden="true"
                      p:render="@{T(org.kuali.student.myplan.plan.util.AtpHelper).getUserSessionHelper().isAdviser() AND #line.selectedCredit NE null}">
                    <property name="control">
                        <bean parent="Uif-HiddenControl"/>
                    </property>
                </bean>

                <bean id="messy_credits" parent="KSAP-SimpleInputField" p:propertyName="selectedCredit"
                      p:render="@{!T(org.kuali.student.myplan.plan.util.AtpHelper).getUserSessionHelper().isAdviser() OR #line.selectedCredit NE null}">
                    <property name="cssClasses" value="removeMargin"/>
                    <property name="optionsFinder">
                        <bean class="org.kuali.student.myplan.course.util.PlanAuditMessyItems"/>
                    </property>
                    <property name="control">
                        <bean parent="Uif-DropdownControl">
                            <property name="onChangeScript"
                                      value="buttonState('plan_audit_messy_items', 'submit_plan_audit');"/>
                            <property name="cssClasses" value="requiredField"/>
                        </bean>
                    </property>

                    <property name="propertyReplacers">
                        <list>
                            <bean parent="Uif-ConditionalBeanPropertyReplacer" p:propertyName="control"
                                  p:condition="T(org.kuali.student.myplan.plan.util.AtpHelper).getUserSessionHelper().isAdviser()">
                                <property name="replacement">
                                    <bean parent="Uif-DropdownControl" p:disabled="true">
                                        <property name="onChangeScript"
                                                  value="buttonState('plan_audit_messy_items', 'submit_plan_audit');"/>
                                        <property name="cssClasses" value="requiredField"/>
                                    </bean>
                                </property>
                            </bean>
                        </list>
                    </property>
                </bean>

                <bean p:id="hidden_version_independent_id" parent="KSAP-SimpleInputField"
                      p:propertyName="versionIndependentId"
                      p:hidden="true">
                    <property name="control">
                        <bean parent="Uif-HiddenControl"/>
                    </property>
                </bean>
                <bean p:id="hidden_course_id" parent="KSAP-SimpleInputField" p:propertyName="courseId" p:hidden="true">
                    <property name="control">
                        <bean parent="Uif-HiddenControl"/>
                    </property>
                </bean>
                <bean p:id="hidden_course_code" parent="KSAP-SimpleInputField" p:propertyName="courseCode"
                      p:hidden="true">
                    <property name="control">
                        <bean parent="Uif-HiddenControl"/>
                    </property>
                </bean>
                <bean p:id="hidden_course_subject" parent="KSAP-SimpleInputField" p:propertyName="subject"
                      p:hidden="true">
                    <property name="control">
                        <bean parent="Uif-HiddenControl"/>
                    </property>
                </bean>
                <bean p:id="hidden_course_number" parent="KSAP-SimpleInputField" p:propertyName="number"
                      p:hidden="true">
                    <property name="control">
                        <bean parent="Uif-HiddenControl"/>
                    </property>
                </bean>
                <bean p:id="hidden_atp_id" parent="KSAP-SimpleInputField" p:propertyName="atpId" p:hidden="true">
                    <property name="control">
                        <bean parent="Uif-HiddenControl"/>
                    </property>
                </bean>
                <bean p:id="hidden_course_title" parent="KSAP-SimpleInputField" p:propertyName="courseTitle"
                      p:hidden="true">
                    <property name="control">
                        <bean parent="Uif-HiddenControl"/>
                    </property>
                </bean>
            </list>
        </property>
    </bean>

    <bean id="plan_audit_ignore_items" parent="KSAP-StackedCollectionGroup" p:id="plan_audit_ignore_items">
        <property name="collectionObjectClass"
                  value="org.kuali.student.myplan.audit.dataobject.IgnoreTermDataObject"/>
        <property name="propertyName" value="planAudit.ignoreList"/>
        <property name="bindingInfo.bindToForm" value="true"/>
        <property name="readOnly" value="false"/>
        <property name="cssClasses" value="auditHandOff__ignore alert"/>
        <property name="header">
            <bean parent="KSAP-HeaderFour" p:headerText="Excluded Courses" p:headerTagCssClasses="auditHandOff__excludeHeaderText uppercase"/>
        </property>
        <property name="instructionalMessage">
            <bean parent="KSAP-Message"
                  p:messageText="The following course(s) are not included in the Plan Audit because they may not be offered in the quarter planned.">
            </bean>
        </property>
        <property name="layoutManager.cssClasses" value="uif-stackedCollectionLayout defaultTopMargin defaultBottomMargin"/>
        <property name="items">
            <list/>
        </property>
        <property name="subCollections">
            <list>
                <ref bean="plan_audit_ignore_block"/>
            </list>
        </property>
    </bean>

    <bean id="plan_audit_ignore_block" parent="KSAP-StackedCollectionGroup">
        <property name="collectionObjectClass"
                  value="org.kuali.student.myplan.audit.dataobject.CourseItem"/>
        <property name="propertyName" value="courseItemList"/>
        <property name="bindingInfo.bindToForm" value="true"/>
        <property name="readOnly" value="true"/>
        <property name="header">
            <bean parent="KSAP-HeaderFour" p:headerText="@{T(org.kuali.student.myplan.plan.util.AtpHelper).atpIdToTermName(#line.atpId)}"
                  p:headerTagCssClasses="auditHandOff__excludeHeaderText"/>
        </property>
        <property name="items">
            <list>
                <bean parent="KSAP-MessageField" p:messageText="[0] @{#line.title} (@{#line.credit})">
                    <property name="inlineComponents">
                        <list>
                            <bean parent="Uif-Link" p:linkText="@{#line.courseCode}">
                                <property name="title" value="@{#line.courseCode}"/>
                                <property name="href"
                                          value="inquiry?methodToCall=start&amp;viewId=CourseDetails-InquiryView&amp;courseId=@{#line.courseId}&amp;courseCd=@{#line.courseCode NE null ? #line.courseCode.replace('&amp;','%26') : #line.courseCode}"/>
                            </bean>
                        </list>
                    </property>
                </bean>
            </list>
        </property>
    </bean>

</beans>
