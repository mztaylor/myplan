<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:p="http://www.springframework.org/schema/p"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
                    http://www.springframework.org/schema/beans/spring-beans-3.0.xsd">
    <!-- Copyright 2007-2009 The Kuali Foundation Licensed under the Educational
         Community License, Version 2.0 (the "License"); you may not use this file
         except in compliance with the License. You may obtain a copy of the License
         at http://www.opensource.org/licenses/ecl2.php Unless required by applicable
         law or agreed to in writing, software distributed under the License is distributed
         on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either
         express or implied. See the License for the specific language governing permissions
         and limitations under the License. -->


    <bean id="CourseSearch-FormView" parent="MyPlanFormView">
        <property name="id" value="CourseSearch-FormView"/>
        <property name="entryPageId" value="course_search"/>
        <property name="formClass" value="org.kuali.student.myplan.course.form.CourseSearchForm"/>
        <property name="headerText" value="Find Courses"/>
        <property name="footer.render" value="false"/>
        <property name="items">
            <list>
                <bean parent="KSAP-Page" p:id="course_search">
                    <property name="instructionalMessage">
                        <bean parent="KSAP-Message">
                            <property name="messageText"
                                      value="Enter a course code, title, or a keyword to search the Course Catalog and Time Schedule if applicable. [0]"/>
                            <property name="inlineComponents">
                                <list>
                                    <bean parent="Uif-Link" p:linkText="Learn more" p:target="_blank"
                                          p:href="http://depts.washington.edu/myplan/help-site/#815"/>
                                </list>
                            </property>
                        </bean>
                    </property>
                    <property name="items">
                        <list>
                            <bean parent="course_search_result_section" p:width="710px"/>
                            <ref bean="KSAP-RightPane"/>
                        </list>
                    </property>
                </bean>
            </list>
        </property>
    </bean>

    <!-- Layout for Empty Course Search Form Page  -->
    <bean id="course_search_section" parent="KSAP-VerticalBoxGroup" p:width="710px">
        <property name="items">
            <list>
                <ref bean="course_search_panel"/>
            </list>
        </property>
    </bean>

    <!-- Layout for Course Search Result Page -->
    <bean id="course_search_result_section" parent="KSAP-VerticalBoxGroup" p:width="710px">
        <property name="items">
            <list>
                <ref bean="course_search_panel"/>
                <ref bean="course_search_results_panel"/>
                <ref bean="add_course_items"/>
            </list>
        </property>
    </bean>

    <!-- Group for Search Fields Container -->
    <bean id="course_search_panel" parent="KSAP-VerticalBoxGroup">
        <property name="cssClasses" value="courseSearch__query"/>
        <property name="items">
            <list>
                <ref bean="course_search_fields"/>
                <ref bean="course_search_params"/>
            </list>
        </property>
    </bean>

    <!-- Group for Search Input Fields -->
    <bean id="course_search_fields" parent="KSAP-HorizontalBoxGroup">
        <property name="items">
            <list>
                <bean id="searchQuery" parent="KSAP-SimpleInputField" p:propertyName="searchQuery" p:label="Search for">
                    <property name="fieldLabel.render" value="true"/>
                    <property name="fieldLabel.cssClasses" value="courseSearch__label"/>
                    <property name="labelPlacement" value="LEFT"/>
                    <property name="control">
                        <bean parent="Uif-TextControl" p:watermarkText="e.g. COM, Math 124, ENGL 1XX, sun">
                            <property name="cssClasses" value="courseSearch__field"/>
                            <property name="onDocumentReadyScript" value="
                                if (readUrlHash('searchQuery')) {
                                    jQuery('#searchQuery_control').val(readUrlHash('searchQuery'));
                                }
                            "/>
                            <property name="onKeyPressScript" value="
                                var code = (e.keyCode ? e.keyCode : e.which);
                                if (code == 13) {
                                    e.preventDefault ? e.preventDefault() : e.returnValue = false;
                                    jQuery('button.courseSearch__submit').click();
                                }
                            "/>
                        </bean>
                    </property>
                </bean>
                <bean id="selectTerm" parent="KSAP-SimpleInputField" p:propertyName="searchTerm" p:label="in">
                    <property name="fieldLabel.render" value="true"/>
                    <property name="fieldLabel.cssClasses" value="courseSearch__label courseSearch__label--bold"/>
                    <property name="labelPlacement" value="LEFT"/>
                    <property name="control">
                        <bean parent="Uif-DropdownControl">
                            <property name="cssClasses" value="courseSearch__field"/>
                            <property name="onDocumentReadyScript" value="
                                if (readUrlHash('searchTerm')) {
                                    jQuery('#selectTerm_control').val(readUrlHash('searchTerm'));
                                }"/>
                        </bean>
                    </property>
                    <property name="optionsFinder">
                        <bean class="org.kuali.student.myplan.utils.PublishedTermsListBuilder">
                            <property name="suffix" value=" quarter only"/>
                            <property name="additionalListItemsTop">
                                <map>
                                    <entry key="any" value="Any quarter"/>
                                </map>
                            </property>
                        </bean>
                    </property>
                </bean>
                <bean p:id="searchForCourses" parent="KSAP-PrimaryActionButton" p:actionLabel="Search">
                    <property name="cssClasses">
                        <list merge="true">
                            <value>courseSearch__submit</value>
                        </list>
                    </property>
                    <property name="disabled" value="@{#form.searchQuery EQ null}"/>
                    <property name="evaluateDisabledOnKeyUp" value="true"/>
                    <property name="actionScript" value="
                        searchForCourses('course_search_results','course_search_results_panel');
                    "/>
                </bean>
            </list>
        </property>
    </bean>

    <!-- Group for Search Input Parameters -->
    <bean id="course_search_params" parent="KSAP-HorizontalBoxGroup">
        <property name="items">
            <list>
                <bean id="radio_campusSelect" parent="KSAP-SimpleInputField" p:propertyName="campusSelect">
                    <property name="cssClasses" value="courseSearch__fieldset"/>
                    <property name="defaultValues">
                        <list>
                            <value>306</value>
                            <value>310</value>
                            <value>323</value>
                        </list>
                    </property>
                    <property name="control">
                        <bean parent="Uif-HorizontalCheckboxesControl">
                            <property name="cssClasses" value="courseSearch__input"/>
                            <property name="onDocumentReadyScript" value="
                                if (readUrlHash('campusSelect')) {
                                    jQuery.each(jQuery(&quot;input[name='campusSelect']&quot;), function() {
                                        if (jQuery.inArray(jQuery(this).val(), readUrlHash('campusSelect').split(',')) != -1) {
                                            jQuery(this).attr('checked','checked');
                                        } else {
                                            jQuery(this).removeAttr('checked');
                                        }
                                    });
                                }"/>
                        </bean>
                    </property>
                    <property name="optionsFinder">
                        <bean class="org.kuali.student.myplan.course.util.CampusSearch"/>
                    </property>
                </bean>
            </list>
        </property>
    </bean>

    <!-- Layout for Search Facets and Search Results -->
    <bean id="course_search_results_panel" parent="KSAP-HorizontalBoxGroup">
        <property name="onDocumentReadyScript" value="
            if (readUrlHash('searchQuery')) {
                jQuery('button.courseSearch__submit').prop('disabled', false).removeClass('disabled');
                searchForCourses('course_search_results','course_search_results_panel');
            }
        "/>
        <property name="cssClasses" value="courseResults"/>
        <property name="layoutManager.style" value="display: none;"/>
        <property name="items">
            <list>
                <ref bean="course_search_results_facets"/>
                <ref bean="course_search_results"/>
            </list>
        </property>
    </bean>

    <bean id="course_search_results" parent="Uif-DataTable">
        <property name="cssClasses">
            <list merge="true">
                <value>courseResults__table</value>
            </list>
        </property>
        <property name="onDocumentReadyScript" value="
            jQuery('#course_search_results').on('PLAN_ITEM_DELETED', function(event, data){
                if (data.planItemType === 'wishlist') {
                    restoreSearchAddButton(data.courseId);
                }
            }).on('PLAN_ITEM_ADDED', function(event, data){
                if (data.planItemType === 'wishlist') {
                    actionFeedback(data.courseId + '_status', false, null, 'bookmarked', 'Bookmarked');
                }
            }).on('PLAN_ITEM_ADDED', function(event, data){
                if (data.planItemType === 'planned' || data.planItemType === 'backup') {
                    actionFeedback(data.courseId + '_status', false, null, 'planned', 'Planned');
                }
            });
        "/>
        <property name="richTable.templateOptions">
            <map merge="true">
                <entry key="aLengthMenu" value="[ 20, 50, 100 ]"/>
                <entry key="aaSorting" value="[]"/>
                <entry key="aoColumns" value="[
                    {'sTitle':'Code','bSortable':true, 'bSearchable':false, 'sClass':'courseResults__tableHeader--sortable', 'sWidth':'73px'},
                    {'sTitle':'Course Name','bSortable':true, 'bSearchable':false, 'sClass':'courseResults__tableHeader--sortable', 'sWidth':'188px'},
                    {'sTitle':'Credits','bSortable':false, 'bSearchable':false, 'sWidth':'36px'},
                    {'sTitle':'Quarter Offered', 'bSortable':false, 'bSearchable':false, 'sClass':'termBadge', 'sWidth':'80px'},
                    {'sTitle':'Gen Edu Req', 'bSortable':false, 'bSearchable':false, 'sWidth':'69px'},
                    {'sTitle':'', 'bSortable':false, 'bSearchable':false, 'sClass':'courseResults__item--right', 'sWidth':'62px'},
                    {'sTitle':'facetQuarter', 'bVisible':false},
                    {'sTitle':'facetGenEduReq', 'bVisible':false},
                    {'sTitle':'facetCredits', 'bVisible':false},
                    {'sTitle':'facetLevel', 'bVisible':false},
                    {'sTitle':'facetCurriculum', 'bVisible':false}
                ]"/>
                <entry key="bAutoWidth" value="false"/>
                <entry key="bDeferRender" value="true"/>
                <entry key="bDestroy" value="true"/>
                <entry key="bJQueryUI" value="true"/>
                <entry key="bScrollCollapse" value="true"/>
                <entry key="bServerSide" value="false"/>
                <entry key="bSortClasses" value="false"/>
                <entry key="bStateSave" value="false"/>
                <entry key="iCookieDuration" value="0"/>
                <entry key="iDisplayLength" value="20"/>
                <entry key="fnDrawCallback" value="
                    function (oSettings) {
                            if (Math.ceil((oSettings.fnRecordsDisplay()) / oSettings._iDisplayLength) > 1)  {
                                jQuery('.dataTables_paginate span').not('.first, .last').show();
                            } else {
                                jQuery('.dataTables_paginate span').hide();
                            }
                    }
                "/>
                <entry key="oLanguage" value="{
                    'sEmptyTable':'0 results found',
                    'sInfo':'Showing _START_-_END_ of _TOTAL_ results',
                    'sInfoEmpty':'0 results found',
                    'sInfoFiltered':'',
                    'sLengthMenu':'Show _MENU_',
                    'sZeroRecords':'0 results found'
                }"/>
                <entry key="sCookiePrefix" value="course_search_"/>
                <entry key="sDom" value="ilrtSp"/>
                <entry key="sPaginationType" value="full_numbers"/>
            </map>
        </property>
    </bean>

    <!-- Group for Search Facets -->
    <bean id="course_search_results_facets" parent="KSAP-VerticalBoxGroup" p:headerText="Narrow Results">
        <property name="cssClasses" value="courseResults__facetGroup"/>
        <property name="header">
            <bean parent="KSAP-HeaderDiv" p:cssClasses="courseResults__facetGroupHeader"/>
        </property>
        <property name="items">
            <list>
                <ref bean="facet_quarter"/>
                <ref bean="facet_genedureq"/>
                <ref bean="facet_credits"/>
                <ref bean="facet_level"/>
                <ref bean="facet_curriculum"/>
            </list>
        </property>
    </bean>

    <bean id="facet_group" parent="KSAP-VerticalBoxGroup" p:headerText="Facet">
        <property name="disclosure.render" value="true"/>
        <property name="disclosure.expandImageSrc" value="@{#ConfigProperties['ks.myplan.externalizable.images.url']}/pixel.gif"/>
        <property name="disclosure.collapseImageSrc" value="@{#ConfigProperties['ks.myplan.externalizable.images.url']}/pixel.gif"/>
        <property name="cssClasses" value="courseResults__facet"/>
        <property name="header">
            <bean parent="KSAP-HeaderDiv">
                <property name="cssClasses" value="courseResults__facetHeader"/>
                <property name="headerTagCssClasses" value="uif-headerText-span"/>
            </bean>
        </property>
    </bean>

    <bean id="facet_quarter" parent="facet_group" p:headerText="Quarter">
        <property name="header.rightGroup">
            <bean parent="KSAP-HorizontalBoxGroup">
                <property name="cssClasses" value="courseResults__facetHeaderHelp"/>
                <property name="items">
                    <list>
                        <ref bean="quarter_facet_help_icon"/>
                    </list>
                </property>
            </bean>
        </property>
        <property name="onDocumentReadyScript" value="
            jQuery('#facet_quarter').on('GENERATE_FACETS', function(event){
                fnGenerateFacetGroup(6, jQuery(this), terms);
            }).on('UPDATE_FACETS', function(event, data){
                fnUpdateFacetList(data, 6, jQuery(this));
            });
        "/>
    </bean>

    <bean id="facet_genedureq" parent="facet_group" p:headerText="Gen. Edu. Req.">
        <property name="onDocumentReadyScript" value="
            jQuery('#facet_genedureq').on('GENERATE_FACETS', function(event){
                fnGenerateFacetGroup(7, jQuery(this), alpha);
            }).on('UPDATE_FACETS', function(event, data){
                fnUpdateFacetList(data, 7, jQuery(this));
            });
        "/>
    </bean>

    <bean id="facet_credits" parent="facet_group" p:headerText="Credits">
        <property name="onDocumentReadyScript" value="
            jQuery('#facet_credits').on('GENERATE_FACETS', function(event){
                fnGenerateFacetGroup(8, jQuery(this), numeric);
            }).on('UPDATE_FACETS', function(event, data){
                fnUpdateFacetList(data, 8, jQuery(this));
            });
        "/>
    </bean>

    <bean id="facet_level" parent="facet_group" p:headerText="Course Level">
        <property name="onDocumentReadyScript" value="
            jQuery('#facet_level').on('GENERATE_FACETS', function(event){
                fnGenerateFacetGroup(9, jQuery(this), numeric);
            }).on('UPDATE_FACETS', function(event, data){
                fnUpdateFacetList(data, 9, jQuery(this));
            });
        "/>
    </bean>

    <bean id="facet_curriculum" parent="facet_group" p:headerText="Course Prefix">
        <property name="onDocumentReadyScript" value="
            jQuery('#facet_curriculum').on('GENERATE_FACETS', function(event){
                fnGenerateFacetGroup(10, jQuery(this), alpha);
            }).on('UPDATE_FACETS', function(event, data){
                fnUpdateFacetList(data, 10, jQuery(this));
            });
        "/>
    </bean>

    <!--Add Course Menu-->
    <bean id="add_course_items" parent="KSAP-VerticalBoxGroup" p:width="75px" p:hidden="true" p:cssClasses="popover__menu">
        <property name="items">
            <list>
                <bean parent="Uif-ActionLink" p:actionLabel="Add to Plan" p:title="Add to Plan">
                    <property name="actionScript" value="
                        var retrieveData = {action:'plan', viewId:'PlannedCourse-FormView', methodToCall:'startAddPlannedCourseForm', courseId:jQuery(this).data('courseid'), pageId:'add_dialog_page'};
                        var popupStyle = {width:'300px', height:'16px'};
                        var popupOptions = {tail:{hidden:true}, align:'top', close:true};
                        openPopup('add_dialog_page', retrieveData, 'plan', popupStyle, popupOptions, e);
                    "/>
                </bean>
                <bean parent="Uif-ActionLink" p:actionLabel="Bookmark" p:title="Bookmark">
                    <property name="actionScript" value="
                        var additionalFormData = {viewId:'PlannedCourse-FormView', methodToCall:'addSavedCourse', courseId:jQuery(this).data('courseid')};
                        submitHiddenForm('plan', additionalFormData, e);
                    "/>
                </bean>
            </list>
        </property>
    </bean>

</beans>
